# ComfyUI Gemini文本处理器

这是一个ComfyUI自定义节点，使用Google Gemini API进行文本扩写和翻译功能。

## 功能特性

- **文本扩写**: 使用Gemini API对输入文本进行智能扩写
- **英文翻译**: 将中文文本翻译成英文
- **灵活控制**: 提供扩写和翻译的独立开关
- **多种风格**: 支持多种扩写风格（详细描述、创意扩展、专业术语、生动形象）
- **错误处理**: 完善的错误处理和重试机制

## 安装方法

1. 将以下文件复制到ComfyUI的custom_nodes目录下：
   - `gemini_text_processor.py`
   - `gemini_utils.py`
   - `config.py`

2. 安装依赖包：
   ```bash
   pip install requests
   ```

3. 重启ComfyUI

## 使用方法

### 1. 获取Gemini API密钥

1. 访问 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 创建新的API密钥
3. 复制API密钥备用

### 2. 在ComfyUI中使用

1. 在节点菜单中找到 "text" 分类下的 "Gemini文本处理器"
2. 添加节点到工作流
3. 配置节点参数：

#### 输入参数

- **text**: 要处理的输入文本（支持多行）
- **api_key**: 你的Gemini API密钥
- **enable_expansion**: 是否启用文本扩写功能
- **enable_translation**: 是否启用英文翻译功能
- **expansion_style**: 扩写风格选择
  - 详细描述：增加更多描述性内容和细节
  - 创意扩展：增加想象力和艺术性描述
  - 专业术语：扩写为更专业和技术性的描述
  - 生动形象：使用比喻和修辞手法
- **max_tokens**: 最大输出token数量（100-4000）

#### 输出结果

- **原始文本**: 输入的原始文本
- **处理后文本**: 扩写后的文本（如果启用扩写）
- **英文翻译**: 翻译后的英文文本（如果启用翻译）

### 3. 使用场景

#### 场景1：仅扩写
- 启用扩写开关
- 禁用翻译开关
- 选择合适的扩写风格

#### 场景2：仅翻译
- 禁用扩写开关
- 启用翻译开关

#### 场景3：扩写+翻译
- 启用扩写开关
- 启用翻译开关
- 系统会先扩写，然后翻译扩写后的文本

## 配置说明

### API配置
在 `config.py` 中可以调整：
- API超时时间
- 重试次数
- 默认温度参数
- 其他生成参数

### 扩写风格配置
每种扩写风格都有独立的：
- 提示词模板
- 温度参数
- 可以根据需要自定义

## 错误处理

节点包含完善的错误处理机制：
- API密钥验证
- 网络请求重试
- 超时处理
- 错误信息返回

## 注意事项

1. **API密钥安全**: 请妥善保管你的Gemini API密钥，不要在公共场所暴露
2. **网络连接**: 确保ComfyUI运行环境可以访问Google API
3. **API配额**: 注意Gemini API的使用配额限制
4. **文本长度**: 建议单次处理的文本不要过长，以免超出API限制

## 故障排除

### 常见问题

1. **"请提供有效的Gemini API密钥"**
   - 检查API密钥是否正确
   - 确认API密钥是否已激活

2. **"API请求失败"**
   - 检查网络连接
   - 确认API配额是否充足
   - 检查API密钥权限

3. **"处理超时"**
   - 减少输入文本长度
   - 降低max_tokens参数
   - 检查网络稳定性

## 更新日志

### v1.0.0
- 初始版本发布
- 支持文本扩写和翻译功能
- 提供多种扩写风格
- 完善的错误处理机制

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。